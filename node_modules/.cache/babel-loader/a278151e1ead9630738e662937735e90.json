{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport updateMutation from './util/updateMutation';\nimport rangeSort from './util/rangeSort';\nimport getElementHTML from './util/getElementHTML';\nimport getElementTagLength from './util/getElementTagLength';\n\nvar converter = function converter() {\n  var entity = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var originalText = arguments.length > 1 ? arguments[1] : undefined;\n  return originalText;\n};\n\nexport default (function (block, entityMap) {\n  var entityConverter = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : converter;\n\n  var resultText = _toConsumableArray(block.text);\n\n  var getEntityHTML = entityConverter;\n\n  if (entityConverter.__isMiddleware) {\n    getEntityHTML = entityConverter(converter);\n  }\n\n  if (Object.prototype.hasOwnProperty.call(block, 'entityRanges') && block.entityRanges.length > 0) {\n    var entities = block.entityRanges.sort(rangeSort);\n    var styles = block.inlineStyleRanges;\n\n    var _loop = function _loop(index) {\n      var entityRange = entities[index];\n      var entity = entityMap[entityRange.key];\n      var originalText = resultText.slice(entityRange.offset, entityRange.offset + entityRange.length).join('');\n      var entityHTML = getEntityHTML(entity, originalText);\n\n      var converted = _toConsumableArray(getElementHTML(entityHTML, originalText) || originalText);\n\n      var prefixLength = getElementTagLength(entityHTML, 'start');\n      var suffixLength = getElementTagLength(entityHTML, 'end');\n\n      var updateLaterMutation = function updateLaterMutation(mutation, mutationIndex) {\n        if (mutationIndex > index || Object.prototype.hasOwnProperty.call(mutation, 'style')) {\n          return updateMutation(mutation, entityRange.offset, entityRange.length, converted.length, prefixLength, suffixLength);\n        }\n\n        return mutation;\n      };\n\n      var updateLaterMutations = function updateLaterMutations(mutationList) {\n        return mutationList.reduce(function (acc, mutation, mutationIndex) {\n          var updatedMutation = updateLaterMutation(mutation, mutationIndex);\n\n          if (Array.isArray(updatedMutation)) {\n            return acc.concat(updatedMutation);\n          }\n\n          return acc.concat([updatedMutation]);\n        }, []);\n      };\n\n      entities = updateLaterMutations(entities);\n      styles = updateLaterMutations(styles);\n      resultText = [].concat(_toConsumableArray(resultText.slice(0, entityRange.offset)), _toConsumableArray(converted), _toConsumableArray(resultText.slice(entityRange.offset + entityRange.length)));\n    };\n\n    for (var index = 0; index < entities.length; index++) {\n      _loop(index);\n    }\n\n    return Object.assign({}, block, {\n      text: resultText.join(''),\n      inlineStyleRanges: styles,\n      entityRanges: entities\n    });\n  }\n\n  return block;\n});","map":{"version":3,"sources":["/home/anthony/Desktop/if-you-were-here/node_modules/draft-convert/esm/blockEntities.js"],"names":["_toConsumableArray","updateMutation","rangeSort","getElementHTML","getElementTagLength","converter","entity","arguments","length","undefined","originalText","block","entityMap","entityConverter","resultText","text","getEntityHTML","__isMiddleware","Object","prototype","hasOwnProperty","call","entityRanges","entities","sort","styles","inlineStyleRanges","_loop","index","entityRange","key","slice","offset","join","entityHTML","converted","prefixLength","suffixLength","updateLaterMutation","mutation","mutationIndex","updateLaterMutations","mutationList","reduce","acc","updatedMutation","Array","isArray","concat","assign"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport updateMutation from './util/updateMutation';\nimport rangeSort from './util/rangeSort';\nimport getElementHTML from './util/getElementHTML';\nimport getElementTagLength from './util/getElementTagLength';\n\nvar converter = function converter() {\n  var entity = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var originalText = arguments.length > 1 ? arguments[1] : undefined;\n  return originalText;\n};\n\nexport default (function (block, entityMap) {\n  var entityConverter = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : converter;\n\n  var resultText = _toConsumableArray(block.text);\n\n  var getEntityHTML = entityConverter;\n\n  if (entityConverter.__isMiddleware) {\n    getEntityHTML = entityConverter(converter);\n  }\n\n  if (Object.prototype.hasOwnProperty.call(block, 'entityRanges') && block.entityRanges.length > 0) {\n    var entities = block.entityRanges.sort(rangeSort);\n    var styles = block.inlineStyleRanges;\n\n    var _loop = function _loop(index) {\n      var entityRange = entities[index];\n      var entity = entityMap[entityRange.key];\n      var originalText = resultText.slice(entityRange.offset, entityRange.offset + entityRange.length).join('');\n      var entityHTML = getEntityHTML(entity, originalText);\n\n      var converted = _toConsumableArray(getElementHTML(entityHTML, originalText) || originalText);\n\n      var prefixLength = getElementTagLength(entityHTML, 'start');\n      var suffixLength = getElementTagLength(entityHTML, 'end');\n\n      var updateLaterMutation = function updateLaterMutation(mutation, mutationIndex) {\n        if (mutationIndex > index || Object.prototype.hasOwnProperty.call(mutation, 'style')) {\n          return updateMutation(mutation, entityRange.offset, entityRange.length, converted.length, prefixLength, suffixLength);\n        }\n\n        return mutation;\n      };\n\n      var updateLaterMutations = function updateLaterMutations(mutationList) {\n        return mutationList.reduce(function (acc, mutation, mutationIndex) {\n          var updatedMutation = updateLaterMutation(mutation, mutationIndex);\n\n          if (Array.isArray(updatedMutation)) {\n            return acc.concat(updatedMutation);\n          }\n\n          return acc.concat([updatedMutation]);\n        }, []);\n      };\n\n      entities = updateLaterMutations(entities);\n      styles = updateLaterMutations(styles);\n      resultText = [].concat(_toConsumableArray(resultText.slice(0, entityRange.offset)), _toConsumableArray(converted), _toConsumableArray(resultText.slice(entityRange.offset + entityRange.length)));\n    };\n\n    for (var index = 0; index < entities.length; index++) {\n      _loop(index);\n    }\n\n    return Object.assign({}, block, {\n      text: resultText.join(''),\n      inlineStyleRanges: styles,\n      entityRanges: entities\n    });\n  }\n\n  return block;\n});"]},"metadata":{},"sourceType":"module"}