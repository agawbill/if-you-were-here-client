{"ast":null,"code":"/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the /src directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\nimport { List, OrderedSet, Map } from 'immutable';\nimport { ContentState, CharacterMetadata, ContentBlock, Entity, BlockMapBuilder, genKey, SelectionState } from 'draft-js';\nimport getSafeBodyFromHTML from './util/parseHTML';\nimport rangeSort from './util/rangeSort';\nvar NBSP = '&nbsp;';\nvar SPACE = ' '; // Arbitrary max indent\n\nvar MAX_DEPTH = 4; // used for replacing characters in HTML\n\n/* eslint-disable no-control-regex */\n\nvar REGEX_CR = new RegExp('\\r', 'g');\nvar REGEX_LF = new RegExp('\\n', 'g');\nvar REGEX_NBSP = new RegExp(NBSP, 'g');\nvar REGEX_BLOCK_DELIMITER = new RegExp('\\r', 'g');\n/* eslint-enable no-control-regex */\n// Block tag flow is different because LIs do not have\n// a deterministic style ;_;\n\nvar blockTags = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'li', 'blockquote', 'pre'];\nvar inlineTags = {\n  b: 'BOLD',\n  code: 'CODE',\n  del: 'STRIKETHROUGH',\n  em: 'ITALIC',\n  i: 'ITALIC',\n  s: 'STRIKETHROUGH',\n  strike: 'STRIKETHROUGH',\n  strong: 'BOLD',\n  u: 'UNDERLINE'\n};\n\nvar handleMiddleware = function handleMiddleware(maybeMiddleware, base) {\n  if (maybeMiddleware && maybeMiddleware.__isMiddleware === true) {\n    return maybeMiddleware(base);\n  }\n\n  return maybeMiddleware;\n};\n\nvar defaultHTMLToBlock = function defaultHTMLToBlock(nodeName, node, lastList) {\n  return undefined;\n};\n\nvar defaultHTMLToStyle = function defaultHTMLToStyle(nodeName, node, currentStyle) {\n  return currentStyle;\n};\n\nvar defaultHTMLToEntity = function defaultHTMLToEntity(nodeName, node) {\n  return undefined;\n};\n\nvar defaultTextToEntity = function defaultTextToEntity(text) {\n  return [];\n};\n\nvar nullthrows = function nullthrows(x) {\n  if (x != null) {\n    return x;\n  }\n\n  throw new Error('Got unexpected null or undefined');\n};\n\nvar sanitizeDraftText = function sanitizeDraftText(input) {\n  return input.replace(REGEX_BLOCK_DELIMITER, '');\n};\n\nfunction getEmptyChunk() {\n  return {\n    text: '',\n    inlines: [],\n    entities: [],\n    blocks: []\n  };\n}\n\nfunction getWhitespaceChunk(inEntity) {\n  var entities = new Array(1);\n\n  if (inEntity) {\n    entities[0] = inEntity;\n  }\n\n  return {\n    text: SPACE,\n    inlines: [OrderedSet()],\n    entities: entities,\n    blocks: []\n  };\n}\n\nfunction getSoftNewlineChunk(block, depth) {\n  var flat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var data = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Map();\n\n  if (flat === true) {\n    return {\n      text: '\\r',\n      inlines: [OrderedSet()],\n      entities: new Array(1),\n      blocks: [{\n        type: block,\n        data: data,\n        depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n      }],\n      isNewline: true\n    };\n  }\n\n  return {\n    text: '\\n',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: []\n  };\n}\n\nfunction getBlockDividerChunk(block, depth) {\n  var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Map();\n  return {\n    text: '\\r',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: [{\n      type: block,\n      data: data,\n      depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n    }]\n  };\n}\n\nfunction getBlockTypeForTag(tag, lastList) {\n  switch (tag) {\n    case 'h1':\n      return 'header-one';\n\n    case 'h2':\n      return 'header-two';\n\n    case 'h3':\n      return 'header-three';\n\n    case 'h4':\n      return 'header-four';\n\n    case 'h5':\n      return 'header-five';\n\n    case 'h6':\n      return 'header-six';\n\n    case 'li':\n      if (lastList === 'ol') {\n        return 'ordered-list-item';\n      }\n\n      return 'unordered-list-item';\n\n    case 'blockquote':\n      return 'blockquote';\n\n    case 'pre':\n      return 'code-block';\n\n    case 'div':\n    case 'p':\n      return 'unstyled';\n\n    default:\n      return null;\n  }\n}\n\nfunction baseCheckBlockType(nodeName, node, lastList) {\n  return getBlockTypeForTag(nodeName, lastList);\n}\n\nfunction processInlineTag(tag, node, currentStyle) {\n  var styleToCheck = inlineTags[tag];\n\n  if (styleToCheck) {\n    currentStyle = currentStyle.add(styleToCheck).toOrderedSet();\n  } else if (node instanceof HTMLElement) {\n    var htmlElement = node;\n    currentStyle = currentStyle.withMutations(function (style) {\n      if (htmlElement.style.fontWeight === 'bold') {\n        style.add('BOLD');\n      }\n\n      if (htmlElement.style.fontStyle === 'italic') {\n        style.add('ITALIC');\n      }\n\n      if (htmlElement.style.textDecoration === 'underline') {\n        style.add('UNDERLINE');\n      }\n\n      if (htmlElement.style.textDecoration === 'line-through') {\n        style.add('STRIKETHROUGH');\n      }\n    }).toOrderedSet();\n  }\n\n  return currentStyle;\n}\n\nfunction baseProcessInlineTag(tag, node) {\n  var inlineStyles = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : OrderedSet();\n  return processInlineTag(tag, node, inlineStyles);\n}\n\nfunction joinChunks(A, B) {\n  var flat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false; // Sometimes two blocks will touch in the DOM and we need to strip the\n  // extra delimiter to preserve niceness.\n\n  var firstInB = B.text.slice(0, 1);\n  var lastInA = A.text.slice(-1);\n  var adjacentDividers = lastInA === '\\r' && firstInB === '\\r';\n  var isJoiningBlocks = A.text !== '\\r' && B.text !== '\\r'; // when joining two full blocks like this we want to pop one divider\n\n  var addingNewlineToEmptyBlock = A.text === '\\r' && !A.isNewline && B.isNewline; // when joining a newline to an empty block we want to remove the newline\n\n  if (adjacentDividers && (isJoiningBlocks || addingNewlineToEmptyBlock)) {\n    A.text = A.text.slice(0, -1);\n    A.inlines.pop();\n    A.entities.pop();\n    A.blocks.pop();\n  } // Kill whitespace after blocks if flat mode is on\n\n\n  if (A.text.slice(-1) === '\\r' && flat === true) {\n    if (B.text === SPACE || B.text === '\\n') {\n      return A;\n    } else if (firstInB === SPACE || firstInB === '\\n') {\n      B.text = B.text.slice(1);\n      B.inlines.shift();\n      B.entities.shift();\n    }\n  }\n\n  var isNewline = A.text.length === 0 && B.isNewline;\n  return {\n    text: A.text + B.text,\n    inlines: A.inlines.concat(B.inlines),\n    entities: A.entities.concat(B.entities),\n    blocks: A.blocks.concat(B.blocks),\n    isNewline: isNewline\n  };\n}\n/*\n * Check to see if we have anything like <p> <blockquote> <h1>... to create\n * block tags from. If we do, we can use those and ignore <div> tags. If we\n * don't, we can treat <div> tags as meaningful (unstyled) blocks.\n */\n\n\nfunction containsSemanticBlockMarkup(html) {\n  return blockTags.some(function (tag) {\n    return html.indexOf(\"<\".concat(tag)) !== -1;\n  });\n}\n\nfunction genFragment(node, inlineStyle, lastList, inBlock, fragmentBlockTags, depth, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, inEntity) {\n  var nodeName = node.nodeName.toLowerCase();\n  var newBlock = false;\n  var nextBlockType = 'unstyled'; // Base Case\n\n  if (nodeName === '#text') {\n    var text = node.textContent;\n\n    if (text.trim() === '' && inBlock === null) {\n      return getEmptyChunk();\n    }\n\n    if (text.trim() === '' && inBlock !== 'code-block') {\n      return getWhitespaceChunk(inEntity);\n    }\n\n    if (inBlock !== 'code-block') {\n      // Can't use empty string because MSWord\n      text = text.replace(REGEX_LF, SPACE);\n    }\n\n    var entities = Array(text.length).fill(inEntity);\n    var offsetChange = 0;\n    var textEntities = checkEntityText(text, createEntity, getEntity, mergeEntityData, replaceEntityData).sort(rangeSort);\n    textEntities.forEach(function (_ref) {\n      var entity = _ref.entity,\n          offset = _ref.offset,\n          length = _ref.length,\n          result = _ref.result;\n      var adjustedOffset = offset + offsetChange;\n\n      if (result === null || result === undefined) {\n        result = text.substr(adjustedOffset, length);\n      }\n\n      var textArray = text.split('');\n      textArray.splice.bind(textArray, adjustedOffset, length).apply(textArray, result.split(''));\n      text = textArray.join('');\n      entities.splice.bind(entities, adjustedOffset, length).apply(entities, Array(result.length).fill(entity));\n      offsetChange += result.length - length;\n    });\n    return {\n      text: text,\n      inlines: Array(text.length).fill(inlineStyle),\n      entities: entities,\n      blocks: []\n    };\n  } // BR tags\n\n\n  if (nodeName === 'br') {\n    var _blockType = inBlock;\n\n    if (_blockType === null) {\n      //  BR tag is at top level, treat it as an unstyled block\n      return getSoftNewlineChunk('unstyled', depth, true);\n    }\n\n    return getSoftNewlineChunk(_blockType || 'unstyled', depth, options.flat);\n  }\n\n  var chunk = getEmptyChunk();\n  var newChunk = null; // Inline tags\n\n  inlineStyle = processInlineTag(nodeName, node, inlineStyle);\n  inlineStyle = processCustomInlineStyles(nodeName, node, inlineStyle); // Handle lists\n\n  if (nodeName === 'ul' || nodeName === 'ol') {\n    if (lastList) {\n      depth += 1;\n    }\n\n    lastList = nodeName;\n    inBlock = null;\n  } // Block Tags\n\n\n  var blockInfo = checkBlockType(nodeName, node, lastList, inBlock);\n  var blockType;\n  var blockDataMap;\n\n  if (blockInfo === false) {\n    return getEmptyChunk();\n  }\n\n  blockInfo = blockInfo || {};\n\n  if (typeof blockInfo === 'string') {\n    blockType = blockInfo;\n    blockDataMap = Map();\n  } else {\n    blockType = typeof blockInfo === 'string' ? blockInfo : blockInfo.type;\n    blockDataMap = blockInfo.data ? Map(blockInfo.data) : Map();\n  }\n\n  if (!inBlock && (fragmentBlockTags.indexOf(nodeName) !== -1 || blockType)) {\n    chunk = getBlockDividerChunk(blockType || getBlockTypeForTag(nodeName, lastList), depth, blockDataMap);\n    inBlock = blockType || getBlockTypeForTag(nodeName, lastList);\n    newBlock = true;\n  } else if (lastList && (inBlock === 'ordered-list-item' || inBlock === 'unordered-list-item') && nodeName === 'li') {\n    var listItemBlockType = getBlockTypeForTag(nodeName, lastList);\n    chunk = getBlockDividerChunk(listItemBlockType, depth);\n    inBlock = listItemBlockType;\n    newBlock = true;\n    nextBlockType = lastList === 'ul' ? 'unordered-list-item' : 'ordered-list-item';\n  } else if (inBlock && inBlock !== 'atomic' && blockType === 'atomic') {\n    inBlock = blockType;\n    newBlock = true;\n    chunk = getSoftNewlineChunk(blockType, depth, true, // atomic blocks within non-atomic blocks must always be split out\n    blockDataMap);\n  } // Recurse through children\n\n\n  var child = node.firstChild; // hack to allow conversion of atomic blocks from HTML (e.g. <figure><img\n  // src=\"...\" /></figure>). since metadata must be stored on an entity text\n  // must exist for the entity to apply to. the way chunks are joined strips\n  // whitespace at the end so it cannot be a space character.\n\n  if (child == null && inEntity && (blockType === 'atomic' || inBlock === 'atomic')) {\n    child = document.createTextNode('a');\n  }\n\n  if (child != null) {\n    nodeName = child.nodeName.toLowerCase();\n  }\n\n  var entityId = null;\n\n  while (child) {\n    entityId = checkEntityNode(nodeName, child, createEntity, getEntity, mergeEntityData, replaceEntityData);\n    newChunk = genFragment(child, inlineStyle, lastList, inBlock, fragmentBlockTags, depth, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, entityId || inEntity);\n    chunk = joinChunks(chunk, newChunk, options.flat);\n    var sibling = child.nextSibling; // Put in a newline to break up blocks inside blocks\n\n    if (sibling && fragmentBlockTags.indexOf(nodeName) >= 0 && inBlock) {\n      var newBlockInfo = checkBlockType(nodeName, child, lastList, inBlock);\n      var newBlockType = void 0;\n      var newBlockData = void 0;\n\n      if (newBlockInfo !== false) {\n        newBlockInfo = newBlockInfo || {};\n\n        if (typeof newBlockInfo === 'string') {\n          newBlockType = newBlockInfo;\n          newBlockData = Map();\n        } else {\n          newBlockType = newBlockInfo.type || getBlockTypeForTag(nodeName, lastList);\n          newBlockData = newBlockInfo.data ? Map(newBlockInfo.data) : Map();\n        }\n\n        chunk = joinChunks(chunk, getSoftNewlineChunk(newBlockType, depth, options.flat, newBlockData), options.flat);\n      }\n    }\n\n    if (sibling) {\n      nodeName = sibling.nodeName.toLowerCase();\n    }\n\n    child = sibling;\n  }\n\n  if (newBlock) {\n    chunk = joinChunks(chunk, getBlockDividerChunk(nextBlockType, depth, Map()), options.flat);\n  }\n\n  return chunk;\n}\n\nfunction getChunkForHTML(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder) {\n  html = html.trim().replace(REGEX_CR, '').replace(REGEX_NBSP, SPACE);\n  var safeBody = DOMBuilder(html);\n\n  if (!safeBody) {\n    return null;\n  } // Sometimes we aren't dealing with content that contains nice semantic\n  // tags. In this case, use divs to separate everything out into paragraphs\n  // and hope for the best.\n\n\n  var workingBlocks = containsSemanticBlockMarkup(html) ? blockTags.concat(['div']) : ['div']; // Start with -1 block depth to offset the fact that we are passing in a fake\n  // UL block to sta rt with.\n\n  var chunk = genFragment(safeBody, OrderedSet(), 'ul', null, workingBlocks, -1, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options); // join with previous block to prevent weirdness on paste\n\n  if (chunk.text.indexOf('\\r') === 0) {\n    chunk = {\n      text: chunk.text.slice(1),\n      inlines: chunk.inlines.slice(1),\n      entities: chunk.entities.slice(1),\n      blocks: chunk.blocks\n    };\n  } // Kill block delimiter at the end\n\n\n  if (chunk.text.slice(-1) === '\\r') {\n    chunk.text = chunk.text.slice(0, -1);\n    chunk.inlines = chunk.inlines.slice(0, -1);\n    chunk.entities = chunk.entities.slice(0, -1);\n    chunk.blocks.pop();\n  } // If we saw no block tags, put an unstyled one in\n\n\n  if (chunk.blocks.length === 0) {\n    chunk.blocks.push({\n      type: 'unstyled',\n      data: Map(),\n      depth: 0\n    });\n  } // Sometimes we start with text that isn't in a block, which is then\n  // followed by blocks. Need to fix up the blocks to add in\n  // an unstyled block for this content\n\n\n  if (chunk.text.split('\\r').length === chunk.blocks.length + 1) {\n    chunk.blocks.unshift({\n      type: 'unstyled',\n      data: Map(),\n      depth: 0\n    });\n  }\n\n  return chunk;\n}\n\nfunction convertFromHTMLtoContentBlocks(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder, generateKey) {\n  // Be ABSOLUTELY SURE that the dom builder you pass hare won't execute\n  // arbitrary code in whatever environment you're running this in. For an\n  // example of how we try to do this in-browser, see getSafeBodyFromHTML.\n  var chunk = getChunkForHTML(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder, generateKey);\n\n  if (chunk == null) {\n    return [];\n  }\n\n  var start = 0;\n  return chunk.text.split('\\r').map(function (textBlock, blockIndex) {\n    // Make absolutely certain that our text is acceptable.\n    textBlock = sanitizeDraftText(textBlock);\n    var end = start + textBlock.length;\n    var inlines = nullthrows(chunk).inlines.slice(start, end);\n    var entities = nullthrows(chunk).entities.slice(start, end);\n    var characterList = List(inlines.map(function (style, entityIndex) {\n      var data = {\n        style: style,\n        entity: null\n      };\n\n      if (entities[entityIndex]) {\n        data.entity = entities[entityIndex];\n      }\n\n      return CharacterMetadata.create(data);\n    }));\n    start = end + 1;\n    return new ContentBlock({\n      key: generateKey(),\n      type: nullthrows(chunk).blocks[blockIndex].type,\n      data: nullthrows(chunk).blocks[blockIndex].data,\n      depth: nullthrows(chunk).blocks[blockIndex].depth,\n      text: textBlock,\n      characterList: characterList\n    });\n  });\n}\n\nvar convertFromHTML = function convertFromHTML(_ref2) {\n  var _ref2$htmlToStyle = _ref2.htmlToStyle,\n      htmlToStyle = _ref2$htmlToStyle === void 0 ? defaultHTMLToStyle : _ref2$htmlToStyle,\n      _ref2$htmlToEntity = _ref2.htmlToEntity,\n      htmlToEntity = _ref2$htmlToEntity === void 0 ? defaultHTMLToEntity : _ref2$htmlToEntity,\n      _ref2$textToEntity = _ref2.textToEntity,\n      textToEntity = _ref2$textToEntity === void 0 ? defaultTextToEntity : _ref2$textToEntity,\n      _ref2$htmlToBlock = _ref2.htmlToBlock,\n      htmlToBlock = _ref2$htmlToBlock === void 0 ? defaultHTMLToBlock : _ref2$htmlToBlock;\n  return function (html) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      flat: false\n    };\n    var DOMBuilder = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : getSafeBodyFromHTML;\n    var generateKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : genKey;\n    var contentState = ContentState.createFromText('');\n\n    var createEntityWithContentState = function createEntityWithContentState() {\n      if (contentState.createEntity) {\n        var _contentState;\n\n        contentState = (_contentState = contentState).createEntity.apply(_contentState, arguments);\n        return contentState.getLastCreatedEntityKey();\n      }\n\n      return Entity.create.apply(Entity, arguments);\n    };\n\n    var getEntityWithContentState = function getEntityWithContentState() {\n      if (contentState.getEntity) {\n        var _contentState2;\n\n        return (_contentState2 = contentState).getEntity.apply(_contentState2, arguments);\n      }\n\n      return Entity.get.apply(Entity, arguments);\n    };\n\n    var mergeEntityDataWithContentState = function mergeEntityDataWithContentState() {\n      if (contentState.mergeEntityData) {\n        var _contentState3;\n\n        contentState = (_contentState3 = contentState).mergeEntityData.apply(_contentState3, arguments);\n        return;\n      }\n\n      Entity.mergeData.apply(Entity, arguments);\n    };\n\n    var replaceEntityDataWithContentState = function replaceEntityDataWithContentState() {\n      if (contentState.replaceEntityData) {\n        var _contentState4;\n\n        contentState = (_contentState4 = contentState).replaceEntityData.apply(_contentState4, arguments);\n        return;\n      }\n\n      Entity.replaceData.apply(Entity, arguments);\n    };\n\n    var contentBlocks = convertFromHTMLtoContentBlocks(html, handleMiddleware(htmlToStyle, baseProcessInlineTag), handleMiddleware(htmlToEntity, defaultHTMLToEntity), handleMiddleware(textToEntity, defaultTextToEntity), handleMiddleware(htmlToBlock, baseCheckBlockType), createEntityWithContentState, getEntityWithContentState, mergeEntityDataWithContentState, replaceEntityDataWithContentState, options, DOMBuilder, generateKey);\n    var blockMap = BlockMapBuilder.createFromArray(contentBlocks);\n    var firstBlockKey = contentBlocks[0].getKey();\n    return contentState.merge({\n      blockMap: blockMap,\n      selectionBefore: SelectionState.createEmpty(firstBlockKey),\n      selectionAfter: SelectionState.createEmpty(firstBlockKey)\n    });\n  };\n};\n\nexport default (function () {\n  if (arguments.length >= 1 && typeof (arguments.length <= 0 ? undefined : arguments[0]) === 'string') {\n    return convertFromHTML({}).apply(void 0, arguments);\n  }\n\n  return convertFromHTML.apply(void 0, arguments);\n});","map":{"version":3,"sources":["/home/anthony/Desktop/if-you-were-here/node_modules/draft-convert/esm/convertFromHTML.js"],"names":["List","OrderedSet","Map","ContentState","CharacterMetadata","ContentBlock","Entity","BlockMapBuilder","genKey","SelectionState","getSafeBodyFromHTML","rangeSort","NBSP","SPACE","MAX_DEPTH","REGEX_CR","RegExp","REGEX_LF","REGEX_NBSP","REGEX_BLOCK_DELIMITER","blockTags","inlineTags","b","code","del","em","i","s","strike","strong","u","handleMiddleware","maybeMiddleware","base","__isMiddleware","defaultHTMLToBlock","nodeName","node","lastList","undefined","defaultHTMLToStyle","currentStyle","defaultHTMLToEntity","defaultTextToEntity","text","nullthrows","x","Error","sanitizeDraftText","input","replace","getEmptyChunk","inlines","entities","blocks","getWhitespaceChunk","inEntity","Array","getSoftNewlineChunk","block","depth","flat","arguments","length","data","type","Math","max","min","isNewline","getBlockDividerChunk","getBlockTypeForTag","tag","baseCheckBlockType","processInlineTag","styleToCheck","add","toOrderedSet","HTMLElement","htmlElement","withMutations","style","fontWeight","fontStyle","textDecoration","baseProcessInlineTag","inlineStyles","joinChunks","A","B","firstInB","slice","lastInA","adjacentDividers","isJoiningBlocks","addingNewlineToEmptyBlock","pop","shift","concat","containsSemanticBlockMarkup","html","some","indexOf","genFragment","inlineStyle","inBlock","fragmentBlockTags","processCustomInlineStyles","checkEntityNode","checkEntityText","checkBlockType","createEntity","getEntity","mergeEntityData","replaceEntityData","options","toLowerCase","newBlock","nextBlockType","textContent","trim","fill","offsetChange","textEntities","sort","forEach","_ref","entity","offset","result","adjustedOffset","substr","textArray","split","splice","bind","apply","join","_blockType","chunk","newChunk","blockInfo","blockType","blockDataMap","listItemBlockType","child","firstChild","document","createTextNode","entityId","sibling","nextSibling","newBlockInfo","newBlockType","newBlockData","getChunkForHTML","DOMBuilder","safeBody","workingBlocks","push","unshift","convertFromHTMLtoContentBlocks","generateKey","start","map","textBlock","blockIndex","end","characterList","entityIndex","create","key","convertFromHTML","_ref2","_ref2$htmlToStyle","htmlToStyle","_ref2$htmlToEntity","htmlToEntity","_ref2$textToEntity","textToEntity","_ref2$htmlToBlock","htmlToBlock","contentState","createFromText","createEntityWithContentState","_contentState","getLastCreatedEntityKey","getEntityWithContentState","_contentState2","get","mergeEntityDataWithContentState","_contentState3","mergeData","replaceEntityDataWithContentState","_contentState4","replaceData","contentBlocks","blockMap","createFromArray","firstBlockKey","getKey","merge","selectionBefore","createEmpty","selectionAfter"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the /src directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\nimport { List, OrderedSet, Map } from 'immutable';\nimport { ContentState, CharacterMetadata, ContentBlock, Entity, BlockMapBuilder, genKey, SelectionState } from 'draft-js';\nimport getSafeBodyFromHTML from './util/parseHTML';\nimport rangeSort from './util/rangeSort';\nvar NBSP = '&nbsp;';\nvar SPACE = ' '; // Arbitrary max indent\n\nvar MAX_DEPTH = 4; // used for replacing characters in HTML\n\n/* eslint-disable no-control-regex */\n\nvar REGEX_CR = new RegExp('\\r', 'g');\nvar REGEX_LF = new RegExp('\\n', 'g');\nvar REGEX_NBSP = new RegExp(NBSP, 'g');\nvar REGEX_BLOCK_DELIMITER = new RegExp('\\r', 'g');\n/* eslint-enable no-control-regex */\n// Block tag flow is different because LIs do not have\n// a deterministic style ;_;\n\nvar blockTags = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'li', 'blockquote', 'pre'];\nvar inlineTags = {\n  b: 'BOLD',\n  code: 'CODE',\n  del: 'STRIKETHROUGH',\n  em: 'ITALIC',\n  i: 'ITALIC',\n  s: 'STRIKETHROUGH',\n  strike: 'STRIKETHROUGH',\n  strong: 'BOLD',\n  u: 'UNDERLINE'\n};\n\nvar handleMiddleware = function handleMiddleware(maybeMiddleware, base) {\n  if (maybeMiddleware && maybeMiddleware.__isMiddleware === true) {\n    return maybeMiddleware(base);\n  }\n\n  return maybeMiddleware;\n};\n\nvar defaultHTMLToBlock = function defaultHTMLToBlock(nodeName, node, lastList) {\n  return undefined;\n};\n\nvar defaultHTMLToStyle = function defaultHTMLToStyle(nodeName, node, currentStyle) {\n  return currentStyle;\n};\n\nvar defaultHTMLToEntity = function defaultHTMLToEntity(nodeName, node) {\n  return undefined;\n};\n\nvar defaultTextToEntity = function defaultTextToEntity(text) {\n  return [];\n};\n\nvar nullthrows = function nullthrows(x) {\n  if (x != null) {\n    return x;\n  }\n\n  throw new Error('Got unexpected null or undefined');\n};\n\nvar sanitizeDraftText = function sanitizeDraftText(input) {\n  return input.replace(REGEX_BLOCK_DELIMITER, '');\n};\n\nfunction getEmptyChunk() {\n  return {\n    text: '',\n    inlines: [],\n    entities: [],\n    blocks: []\n  };\n}\n\nfunction getWhitespaceChunk(inEntity) {\n  var entities = new Array(1);\n\n  if (inEntity) {\n    entities[0] = inEntity;\n  }\n\n  return {\n    text: SPACE,\n    inlines: [OrderedSet()],\n    entities: entities,\n    blocks: []\n  };\n}\n\nfunction getSoftNewlineChunk(block, depth) {\n  var flat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var data = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Map();\n\n  if (flat === true) {\n    return {\n      text: '\\r',\n      inlines: [OrderedSet()],\n      entities: new Array(1),\n      blocks: [{\n        type: block,\n        data: data,\n        depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n      }],\n      isNewline: true\n    };\n  }\n\n  return {\n    text: '\\n',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: []\n  };\n}\n\nfunction getBlockDividerChunk(block, depth) {\n  var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Map();\n  return {\n    text: '\\r',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: [{\n      type: block,\n      data: data,\n      depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n    }]\n  };\n}\n\nfunction getBlockTypeForTag(tag, lastList) {\n  switch (tag) {\n    case 'h1':\n      return 'header-one';\n\n    case 'h2':\n      return 'header-two';\n\n    case 'h3':\n      return 'header-three';\n\n    case 'h4':\n      return 'header-four';\n\n    case 'h5':\n      return 'header-five';\n\n    case 'h6':\n      return 'header-six';\n\n    case 'li':\n      if (lastList === 'ol') {\n        return 'ordered-list-item';\n      }\n\n      return 'unordered-list-item';\n\n    case 'blockquote':\n      return 'blockquote';\n\n    case 'pre':\n      return 'code-block';\n\n    case 'div':\n    case 'p':\n      return 'unstyled';\n\n    default:\n      return null;\n  }\n}\n\nfunction baseCheckBlockType(nodeName, node, lastList) {\n  return getBlockTypeForTag(nodeName, lastList);\n}\n\nfunction processInlineTag(tag, node, currentStyle) {\n  var styleToCheck = inlineTags[tag];\n\n  if (styleToCheck) {\n    currentStyle = currentStyle.add(styleToCheck).toOrderedSet();\n  } else if (node instanceof HTMLElement) {\n    var htmlElement = node;\n    currentStyle = currentStyle.withMutations(function (style) {\n      if (htmlElement.style.fontWeight === 'bold') {\n        style.add('BOLD');\n      }\n\n      if (htmlElement.style.fontStyle === 'italic') {\n        style.add('ITALIC');\n      }\n\n      if (htmlElement.style.textDecoration === 'underline') {\n        style.add('UNDERLINE');\n      }\n\n      if (htmlElement.style.textDecoration === 'line-through') {\n        style.add('STRIKETHROUGH');\n      }\n    }).toOrderedSet();\n  }\n\n  return currentStyle;\n}\n\nfunction baseProcessInlineTag(tag, node) {\n  var inlineStyles = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : OrderedSet();\n  return processInlineTag(tag, node, inlineStyles);\n}\n\nfunction joinChunks(A, B) {\n  var flat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  // Sometimes two blocks will touch in the DOM and we need to strip the\n  // extra delimiter to preserve niceness.\n  var firstInB = B.text.slice(0, 1);\n  var lastInA = A.text.slice(-1);\n  var adjacentDividers = lastInA === '\\r' && firstInB === '\\r';\n  var isJoiningBlocks = A.text !== '\\r' && B.text !== '\\r'; // when joining two full blocks like this we want to pop one divider\n\n  var addingNewlineToEmptyBlock = A.text === '\\r' && !A.isNewline && B.isNewline; // when joining a newline to an empty block we want to remove the newline\n\n  if (adjacentDividers && (isJoiningBlocks || addingNewlineToEmptyBlock)) {\n    A.text = A.text.slice(0, -1);\n    A.inlines.pop();\n    A.entities.pop();\n    A.blocks.pop();\n  } // Kill whitespace after blocks if flat mode is on\n\n\n  if (A.text.slice(-1) === '\\r' && flat === true) {\n    if (B.text === SPACE || B.text === '\\n') {\n      return A;\n    } else if (firstInB === SPACE || firstInB === '\\n') {\n      B.text = B.text.slice(1);\n      B.inlines.shift();\n      B.entities.shift();\n    }\n  }\n\n  var isNewline = A.text.length === 0 && B.isNewline;\n  return {\n    text: A.text + B.text,\n    inlines: A.inlines.concat(B.inlines),\n    entities: A.entities.concat(B.entities),\n    blocks: A.blocks.concat(B.blocks),\n    isNewline: isNewline\n  };\n}\n/*\n * Check to see if we have anything like <p> <blockquote> <h1>... to create\n * block tags from. If we do, we can use those and ignore <div> tags. If we\n * don't, we can treat <div> tags as meaningful (unstyled) blocks.\n */\n\n\nfunction containsSemanticBlockMarkup(html) {\n  return blockTags.some(function (tag) {\n    return html.indexOf(\"<\".concat(tag)) !== -1;\n  });\n}\n\nfunction genFragment(node, inlineStyle, lastList, inBlock, fragmentBlockTags, depth, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, inEntity) {\n  var nodeName = node.nodeName.toLowerCase();\n  var newBlock = false;\n  var nextBlockType = 'unstyled'; // Base Case\n\n  if (nodeName === '#text') {\n    var text = node.textContent;\n\n    if (text.trim() === '' && inBlock === null) {\n      return getEmptyChunk();\n    }\n\n    if (text.trim() === '' && inBlock !== 'code-block') {\n      return getWhitespaceChunk(inEntity);\n    }\n\n    if (inBlock !== 'code-block') {\n      // Can't use empty string because MSWord\n      text = text.replace(REGEX_LF, SPACE);\n    }\n\n    var entities = Array(text.length).fill(inEntity);\n    var offsetChange = 0;\n    var textEntities = checkEntityText(text, createEntity, getEntity, mergeEntityData, replaceEntityData).sort(rangeSort);\n    textEntities.forEach(function (_ref) {\n      var entity = _ref.entity,\n          offset = _ref.offset,\n          length = _ref.length,\n          result = _ref.result;\n      var adjustedOffset = offset + offsetChange;\n\n      if (result === null || result === undefined) {\n        result = text.substr(adjustedOffset, length);\n      }\n\n      var textArray = text.split('');\n      textArray.splice.bind(textArray, adjustedOffset, length).apply(textArray, result.split(''));\n      text = textArray.join('');\n      entities.splice.bind(entities, adjustedOffset, length).apply(entities, Array(result.length).fill(entity));\n      offsetChange += result.length - length;\n    });\n    return {\n      text: text,\n      inlines: Array(text.length).fill(inlineStyle),\n      entities: entities,\n      blocks: []\n    };\n  } // BR tags\n\n\n  if (nodeName === 'br') {\n    var _blockType = inBlock;\n\n    if (_blockType === null) {\n      //  BR tag is at top level, treat it as an unstyled block\n      return getSoftNewlineChunk('unstyled', depth, true);\n    }\n\n    return getSoftNewlineChunk(_blockType || 'unstyled', depth, options.flat);\n  }\n\n  var chunk = getEmptyChunk();\n  var newChunk = null; // Inline tags\n\n  inlineStyle = processInlineTag(nodeName, node, inlineStyle);\n  inlineStyle = processCustomInlineStyles(nodeName, node, inlineStyle); // Handle lists\n\n  if (nodeName === 'ul' || nodeName === 'ol') {\n    if (lastList) {\n      depth += 1;\n    }\n\n    lastList = nodeName;\n    inBlock = null;\n  } // Block Tags\n\n\n  var blockInfo = checkBlockType(nodeName, node, lastList, inBlock);\n  var blockType;\n  var blockDataMap;\n\n  if (blockInfo === false) {\n    return getEmptyChunk();\n  }\n\n  blockInfo = blockInfo || {};\n\n  if (typeof blockInfo === 'string') {\n    blockType = blockInfo;\n    blockDataMap = Map();\n  } else {\n    blockType = typeof blockInfo === 'string' ? blockInfo : blockInfo.type;\n    blockDataMap = blockInfo.data ? Map(blockInfo.data) : Map();\n  }\n\n  if (!inBlock && (fragmentBlockTags.indexOf(nodeName) !== -1 || blockType)) {\n    chunk = getBlockDividerChunk(blockType || getBlockTypeForTag(nodeName, lastList), depth, blockDataMap);\n    inBlock = blockType || getBlockTypeForTag(nodeName, lastList);\n    newBlock = true;\n  } else if (lastList && (inBlock === 'ordered-list-item' || inBlock === 'unordered-list-item') && nodeName === 'li') {\n    var listItemBlockType = getBlockTypeForTag(nodeName, lastList);\n    chunk = getBlockDividerChunk(listItemBlockType, depth);\n    inBlock = listItemBlockType;\n    newBlock = true;\n    nextBlockType = lastList === 'ul' ? 'unordered-list-item' : 'ordered-list-item';\n  } else if (inBlock && inBlock !== 'atomic' && blockType === 'atomic') {\n    inBlock = blockType;\n    newBlock = true;\n    chunk = getSoftNewlineChunk(blockType, depth, true, // atomic blocks within non-atomic blocks must always be split out\n    blockDataMap);\n  } // Recurse through children\n\n\n  var child = node.firstChild; // hack to allow conversion of atomic blocks from HTML (e.g. <figure><img\n  // src=\"...\" /></figure>). since metadata must be stored on an entity text\n  // must exist for the entity to apply to. the way chunks are joined strips\n  // whitespace at the end so it cannot be a space character.\n\n  if (child == null && inEntity && (blockType === 'atomic' || inBlock === 'atomic')) {\n    child = document.createTextNode('a');\n  }\n\n  if (child != null) {\n    nodeName = child.nodeName.toLowerCase();\n  }\n\n  var entityId = null;\n\n  while (child) {\n    entityId = checkEntityNode(nodeName, child, createEntity, getEntity, mergeEntityData, replaceEntityData);\n    newChunk = genFragment(child, inlineStyle, lastList, inBlock, fragmentBlockTags, depth, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, entityId || inEntity);\n    chunk = joinChunks(chunk, newChunk, options.flat);\n    var sibling = child.nextSibling; // Put in a newline to break up blocks inside blocks\n\n    if (sibling && fragmentBlockTags.indexOf(nodeName) >= 0 && inBlock) {\n      var newBlockInfo = checkBlockType(nodeName, child, lastList, inBlock);\n      var newBlockType = void 0;\n      var newBlockData = void 0;\n\n      if (newBlockInfo !== false) {\n        newBlockInfo = newBlockInfo || {};\n\n        if (typeof newBlockInfo === 'string') {\n          newBlockType = newBlockInfo;\n          newBlockData = Map();\n        } else {\n          newBlockType = newBlockInfo.type || getBlockTypeForTag(nodeName, lastList);\n          newBlockData = newBlockInfo.data ? Map(newBlockInfo.data) : Map();\n        }\n\n        chunk = joinChunks(chunk, getSoftNewlineChunk(newBlockType, depth, options.flat, newBlockData), options.flat);\n      }\n    }\n\n    if (sibling) {\n      nodeName = sibling.nodeName.toLowerCase();\n    }\n\n    child = sibling;\n  }\n\n  if (newBlock) {\n    chunk = joinChunks(chunk, getBlockDividerChunk(nextBlockType, depth, Map()), options.flat);\n  }\n\n  return chunk;\n}\n\nfunction getChunkForHTML(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder) {\n  html = html.trim().replace(REGEX_CR, '').replace(REGEX_NBSP, SPACE);\n  var safeBody = DOMBuilder(html);\n\n  if (!safeBody) {\n    return null;\n  } // Sometimes we aren't dealing with content that contains nice semantic\n  // tags. In this case, use divs to separate everything out into paragraphs\n  // and hope for the best.\n\n\n  var workingBlocks = containsSemanticBlockMarkup(html) ? blockTags.concat(['div']) : ['div']; // Start with -1 block depth to offset the fact that we are passing in a fake\n  // UL block to sta rt with.\n\n  var chunk = genFragment(safeBody, OrderedSet(), 'ul', null, workingBlocks, -1, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options); // join with previous block to prevent weirdness on paste\n\n  if (chunk.text.indexOf('\\r') === 0) {\n    chunk = {\n      text: chunk.text.slice(1),\n      inlines: chunk.inlines.slice(1),\n      entities: chunk.entities.slice(1),\n      blocks: chunk.blocks\n    };\n  } // Kill block delimiter at the end\n\n\n  if (chunk.text.slice(-1) === '\\r') {\n    chunk.text = chunk.text.slice(0, -1);\n    chunk.inlines = chunk.inlines.slice(0, -1);\n    chunk.entities = chunk.entities.slice(0, -1);\n    chunk.blocks.pop();\n  } // If we saw no block tags, put an unstyled one in\n\n\n  if (chunk.blocks.length === 0) {\n    chunk.blocks.push({\n      type: 'unstyled',\n      data: Map(),\n      depth: 0\n    });\n  } // Sometimes we start with text that isn't in a block, which is then\n  // followed by blocks. Need to fix up the blocks to add in\n  // an unstyled block for this content\n\n\n  if (chunk.text.split('\\r').length === chunk.blocks.length + 1) {\n    chunk.blocks.unshift({\n      type: 'unstyled',\n      data: Map(),\n      depth: 0\n    });\n  }\n\n  return chunk;\n}\n\nfunction convertFromHTMLtoContentBlocks(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder, generateKey) {\n  // Be ABSOLUTELY SURE that the dom builder you pass hare won't execute\n  // arbitrary code in whatever environment you're running this in. For an\n  // example of how we try to do this in-browser, see getSafeBodyFromHTML.\n  var chunk = getChunkForHTML(html, processCustomInlineStyles, checkEntityNode, checkEntityText, checkBlockType, createEntity, getEntity, mergeEntityData, replaceEntityData, options, DOMBuilder, generateKey);\n\n  if (chunk == null) {\n    return [];\n  }\n\n  var start = 0;\n  return chunk.text.split('\\r').map(function (textBlock, blockIndex) {\n    // Make absolutely certain that our text is acceptable.\n    textBlock = sanitizeDraftText(textBlock);\n    var end = start + textBlock.length;\n    var inlines = nullthrows(chunk).inlines.slice(start, end);\n    var entities = nullthrows(chunk).entities.slice(start, end);\n    var characterList = List(inlines.map(function (style, entityIndex) {\n      var data = {\n        style: style,\n        entity: null\n      };\n\n      if (entities[entityIndex]) {\n        data.entity = entities[entityIndex];\n      }\n\n      return CharacterMetadata.create(data);\n    }));\n    start = end + 1;\n    return new ContentBlock({\n      key: generateKey(),\n      type: nullthrows(chunk).blocks[blockIndex].type,\n      data: nullthrows(chunk).blocks[blockIndex].data,\n      depth: nullthrows(chunk).blocks[blockIndex].depth,\n      text: textBlock,\n      characterList: characterList\n    });\n  });\n}\n\nvar convertFromHTML = function convertFromHTML(_ref2) {\n  var _ref2$htmlToStyle = _ref2.htmlToStyle,\n      htmlToStyle = _ref2$htmlToStyle === void 0 ? defaultHTMLToStyle : _ref2$htmlToStyle,\n      _ref2$htmlToEntity = _ref2.htmlToEntity,\n      htmlToEntity = _ref2$htmlToEntity === void 0 ? defaultHTMLToEntity : _ref2$htmlToEntity,\n      _ref2$textToEntity = _ref2.textToEntity,\n      textToEntity = _ref2$textToEntity === void 0 ? defaultTextToEntity : _ref2$textToEntity,\n      _ref2$htmlToBlock = _ref2.htmlToBlock,\n      htmlToBlock = _ref2$htmlToBlock === void 0 ? defaultHTMLToBlock : _ref2$htmlToBlock;\n  return function (html) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      flat: false\n    };\n    var DOMBuilder = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : getSafeBodyFromHTML;\n    var generateKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : genKey;\n    var contentState = ContentState.createFromText('');\n\n    var createEntityWithContentState = function createEntityWithContentState() {\n      if (contentState.createEntity) {\n        var _contentState;\n\n        contentState = (_contentState = contentState).createEntity.apply(_contentState, arguments);\n        return contentState.getLastCreatedEntityKey();\n      }\n\n      return Entity.create.apply(Entity, arguments);\n    };\n\n    var getEntityWithContentState = function getEntityWithContentState() {\n      if (contentState.getEntity) {\n        var _contentState2;\n\n        return (_contentState2 = contentState).getEntity.apply(_contentState2, arguments);\n      }\n\n      return Entity.get.apply(Entity, arguments);\n    };\n\n    var mergeEntityDataWithContentState = function mergeEntityDataWithContentState() {\n      if (contentState.mergeEntityData) {\n        var _contentState3;\n\n        contentState = (_contentState3 = contentState).mergeEntityData.apply(_contentState3, arguments);\n        return;\n      }\n\n      Entity.mergeData.apply(Entity, arguments);\n    };\n\n    var replaceEntityDataWithContentState = function replaceEntityDataWithContentState() {\n      if (contentState.replaceEntityData) {\n        var _contentState4;\n\n        contentState = (_contentState4 = contentState).replaceEntityData.apply(_contentState4, arguments);\n        return;\n      }\n\n      Entity.replaceData.apply(Entity, arguments);\n    };\n\n    var contentBlocks = convertFromHTMLtoContentBlocks(html, handleMiddleware(htmlToStyle, baseProcessInlineTag), handleMiddleware(htmlToEntity, defaultHTMLToEntity), handleMiddleware(textToEntity, defaultTextToEntity), handleMiddleware(htmlToBlock, baseCheckBlockType), createEntityWithContentState, getEntityWithContentState, mergeEntityDataWithContentState, replaceEntityDataWithContentState, options, DOMBuilder, generateKey);\n    var blockMap = BlockMapBuilder.createFromArray(contentBlocks);\n    var firstBlockKey = contentBlocks[0].getKey();\n    return contentState.merge({\n      blockMap: blockMap,\n      selectionBefore: SelectionState.createEmpty(firstBlockKey),\n      selectionAfter: SelectionState.createEmpty(firstBlockKey)\n    });\n  };\n};\n\nexport default (function () {\n  if (arguments.length >= 1 && typeof (arguments.length <= 0 ? undefined : arguments[0]) === 'string') {\n    return convertFromHTML({}).apply(void 0, arguments);\n  }\n\n  return convertFromHTML.apply(void 0, arguments);\n});"]},"metadata":{},"sourceType":"module"}