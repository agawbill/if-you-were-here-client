{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport invariant from 'invariant';\nimport styleObjectFunction from './util/styleObjectFunction';\nimport accumulateFunction from './util/accumulateFunction';\nimport getElementHTML from './util/getElementHTML';\nimport rangeSort from './util/rangeSort';\nimport defaultInlineHTML from './default/defaultInlineHTML';\n\nvar subtractStyles = function subtractStyles(original, toRemove) {\n  return original.filter(function (el) {\n    return !toRemove.some(function (elToRemove) {\n      return elToRemove.style === el.style;\n    });\n  });\n};\n\nvar popEndingStyles = function popEndingStyles(styleStack, endingStyles) {\n  return endingStyles.reduceRight(function (stack, style) {\n    var styleToRemove = stack[stack.length - 1];\n    invariant(styleToRemove.style === style.style, \"Style \".concat(styleToRemove.style, \" to be removed doesn't match expected \").concat(style.style));\n    return stack.slice(0, -1);\n  }, styleStack);\n};\n\nvar characterStyles = function characterStyles(offset, ranges) {\n  return ranges.filter(function (range) {\n    return offset >= range.offset && offset < range.offset + range.length;\n  });\n};\n\nvar rangeIsSubset = function rangeIsSubset(firstRange, secondRange) {\n  // returns true if the second range is a subset of the first\n  var secondStartWithinFirst = firstRange.offset <= secondRange.offset;\n  var secondEndWithinFirst = firstRange.offset + firstRange.length >= secondRange.offset + secondRange.length;\n  return secondStartWithinFirst && secondEndWithinFirst;\n};\n\nvar latestStyleLast = function latestStyleLast(s1, s2) {\n  // make sure longer-lasting styles are added first\n  var s2endIndex = s2.offset + s2.length;\n  var s1endIndex = s1.offset + s1.length;\n  return s2endIndex - s1endIndex;\n};\n\nvar getStylesToReset = function getStylesToReset(remainingStyles, newStyles) {\n  var i = 0;\n\n  while (i < remainingStyles.length) {\n    if (newStyles.every(rangeIsSubset.bind(null, remainingStyles[i]))) {\n      i++;\n    } else {\n      return remainingStyles.slice(i);\n    }\n  }\n\n  return [];\n};\n\nvar appendStartMarkup = function appendStartMarkup(inlineHTML, string, styleRange) {\n  return string + getElementHTML(inlineHTML(styleRange.style)).start;\n};\n\nvar prependEndMarkup = function prependEndMarkup(inlineHTML, string, styleRange) {\n  return getElementHTML(inlineHTML(styleRange.style)).end + string;\n};\n\nvar defaultCustomInlineHTML = function defaultCustomInlineHTML(next) {\n  return function (style) {\n    return next(style);\n  };\n};\n\ndefaultCustomInlineHTML.__isMiddleware = true;\nexport default (function (rawBlock) {\n  var customInlineHTML = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultCustomInlineHTML;\n  invariant(rawBlock !== null && rawBlock !== undefined, 'Expected raw block to be non-null');\n  var inlineHTML;\n\n  if (customInlineHTML.__isMiddleware === true) {\n    inlineHTML = customInlineHTML(defaultInlineHTML);\n  } else {\n    inlineHTML = accumulateFunction(styleObjectFunction(customInlineHTML), styleObjectFunction(defaultInlineHTML));\n  }\n\n  var result = '';\n  var styleStack = [];\n  var sortedRanges = rawBlock.inlineStyleRanges.sort(rangeSort);\n\n  var originalTextArray = _toConsumableArray(rawBlock.text);\n\n  for (var i = 0; i < originalTextArray.length; i++) {\n    var styles = characterStyles(i, sortedRanges);\n    var endingStyles = subtractStyles(styleStack, styles);\n    var newStyles = subtractStyles(styles, styleStack);\n    var remainingStyles = subtractStyles(styleStack, endingStyles); // reset styles: look for any already existing styles that will need to\n    // end before styles that are being added on this character. to solve this\n    // close out those current tags and all nested children,\n    // then open new ones nested within the new styles.\n\n    var resetStyles = getStylesToReset(remainingStyles, newStyles);\n    var openingStyles = resetStyles.concat(newStyles).sort(latestStyleLast);\n    var openingStyleTags = openingStyles.reduce(appendStartMarkup.bind(null, inlineHTML), '');\n    var endingStyleTags = endingStyles.concat(resetStyles).reduce(prependEndMarkup.bind(null, inlineHTML), '');\n    result += endingStyleTags + openingStyleTags + originalTextArray[i];\n    styleStack = popEndingStyles(styleStack, resetStyles.concat(endingStyles));\n    styleStack = styleStack.concat(openingStyles);\n    invariant(styleStack.length === styles.length, \"Character \".concat(i, \": \").concat(styleStack.length - styles.length, \" styles left on stack that should no longer be there\"));\n  }\n\n  result = styleStack.reduceRight(function (res, openStyle) {\n    return res + getElementHTML(inlineHTML(openStyle.style)).end;\n  }, result);\n  return result;\n});","map":{"version":3,"sources":["/home/anthony/Desktop/if-you-were-here/node_modules/draft-convert/esm/blockInlineStyles.js"],"names":["_toConsumableArray","invariant","styleObjectFunction","accumulateFunction","getElementHTML","rangeSort","defaultInlineHTML","subtractStyles","original","toRemove","filter","el","some","elToRemove","style","popEndingStyles","styleStack","endingStyles","reduceRight","stack","styleToRemove","length","concat","slice","characterStyles","offset","ranges","range","rangeIsSubset","firstRange","secondRange","secondStartWithinFirst","secondEndWithinFirst","latestStyleLast","s1","s2","s2endIndex","s1endIndex","getStylesToReset","remainingStyles","newStyles","i","every","bind","appendStartMarkup","inlineHTML","string","styleRange","start","prependEndMarkup","end","defaultCustomInlineHTML","next","__isMiddleware","rawBlock","customInlineHTML","arguments","undefined","result","sortedRanges","inlineStyleRanges","sort","originalTextArray","text","styles","resetStyles","openingStyles","openingStyleTags","reduce","endingStyleTags","res","openStyle"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport invariant from 'invariant';\nimport styleObjectFunction from './util/styleObjectFunction';\nimport accumulateFunction from './util/accumulateFunction';\nimport getElementHTML from './util/getElementHTML';\nimport rangeSort from './util/rangeSort';\nimport defaultInlineHTML from './default/defaultInlineHTML';\n\nvar subtractStyles = function subtractStyles(original, toRemove) {\n  return original.filter(function (el) {\n    return !toRemove.some(function (elToRemove) {\n      return elToRemove.style === el.style;\n    });\n  });\n};\n\nvar popEndingStyles = function popEndingStyles(styleStack, endingStyles) {\n  return endingStyles.reduceRight(function (stack, style) {\n    var styleToRemove = stack[stack.length - 1];\n    invariant(styleToRemove.style === style.style, \"Style \".concat(styleToRemove.style, \" to be removed doesn't match expected \").concat(style.style));\n    return stack.slice(0, -1);\n  }, styleStack);\n};\n\nvar characterStyles = function characterStyles(offset, ranges) {\n  return ranges.filter(function (range) {\n    return offset >= range.offset && offset < range.offset + range.length;\n  });\n};\n\nvar rangeIsSubset = function rangeIsSubset(firstRange, secondRange) {\n  // returns true if the second range is a subset of the first\n  var secondStartWithinFirst = firstRange.offset <= secondRange.offset;\n  var secondEndWithinFirst = firstRange.offset + firstRange.length >= secondRange.offset + secondRange.length;\n  return secondStartWithinFirst && secondEndWithinFirst;\n};\n\nvar latestStyleLast = function latestStyleLast(s1, s2) {\n  // make sure longer-lasting styles are added first\n  var s2endIndex = s2.offset + s2.length;\n  var s1endIndex = s1.offset + s1.length;\n  return s2endIndex - s1endIndex;\n};\n\nvar getStylesToReset = function getStylesToReset(remainingStyles, newStyles) {\n  var i = 0;\n\n  while (i < remainingStyles.length) {\n    if (newStyles.every(rangeIsSubset.bind(null, remainingStyles[i]))) {\n      i++;\n    } else {\n      return remainingStyles.slice(i);\n    }\n  }\n\n  return [];\n};\n\nvar appendStartMarkup = function appendStartMarkup(inlineHTML, string, styleRange) {\n  return string + getElementHTML(inlineHTML(styleRange.style)).start;\n};\n\nvar prependEndMarkup = function prependEndMarkup(inlineHTML, string, styleRange) {\n  return getElementHTML(inlineHTML(styleRange.style)).end + string;\n};\n\nvar defaultCustomInlineHTML = function defaultCustomInlineHTML(next) {\n  return function (style) {\n    return next(style);\n  };\n};\n\ndefaultCustomInlineHTML.__isMiddleware = true;\nexport default (function (rawBlock) {\n  var customInlineHTML = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultCustomInlineHTML;\n  invariant(rawBlock !== null && rawBlock !== undefined, 'Expected raw block to be non-null');\n  var inlineHTML;\n\n  if (customInlineHTML.__isMiddleware === true) {\n    inlineHTML = customInlineHTML(defaultInlineHTML);\n  } else {\n    inlineHTML = accumulateFunction(styleObjectFunction(customInlineHTML), styleObjectFunction(defaultInlineHTML));\n  }\n\n  var result = '';\n  var styleStack = [];\n  var sortedRanges = rawBlock.inlineStyleRanges.sort(rangeSort);\n\n  var originalTextArray = _toConsumableArray(rawBlock.text);\n\n  for (var i = 0; i < originalTextArray.length; i++) {\n    var styles = characterStyles(i, sortedRanges);\n    var endingStyles = subtractStyles(styleStack, styles);\n    var newStyles = subtractStyles(styles, styleStack);\n    var remainingStyles = subtractStyles(styleStack, endingStyles); // reset styles: look for any already existing styles that will need to\n    // end before styles that are being added on this character. to solve this\n    // close out those current tags and all nested children,\n    // then open new ones nested within the new styles.\n\n    var resetStyles = getStylesToReset(remainingStyles, newStyles);\n    var openingStyles = resetStyles.concat(newStyles).sort(latestStyleLast);\n    var openingStyleTags = openingStyles.reduce(appendStartMarkup.bind(null, inlineHTML), '');\n    var endingStyleTags = endingStyles.concat(resetStyles).reduce(prependEndMarkup.bind(null, inlineHTML), '');\n    result += endingStyleTags + openingStyleTags + originalTextArray[i];\n    styleStack = popEndingStyles(styleStack, resetStyles.concat(endingStyles));\n    styleStack = styleStack.concat(openingStyles);\n    invariant(styleStack.length === styles.length, \"Character \".concat(i, \": \").concat(styleStack.length - styles.length, \" styles left on stack that should no longer be there\"));\n  }\n\n  result = styleStack.reduceRight(function (res, openStyle) {\n    return res + getElementHTML(inlineHTML(openStyle.style)).end;\n  }, result);\n  return result;\n});"]},"metadata":{},"sourceType":"module"}